@using BusinessObjects.Models
@inject DataAccessObjects.UserDAO UserDAO
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="~/css/site.css?v=20250714" />
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - Gender Healthcare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    @RenderSection("Styles", required: false)
</head>
<body class="d-flex flex-column min-vh-100">
    @{
        var userId = Context.Session.GetString("UserId");
        var userRole = Context.Session.GetString("Role");
        User? currentUser = null;
        bool isAdmin = false;

        if (!string.IsNullOrEmpty(userId) && int.TryParse(userId, out int uid))
        {
            currentUser = await UserDAO.GetUserById(uid);
            isAdmin = currentUser?.Role == "Admin";
        }
    }
    <!-- Navbar -->
    <nav class="navbar sticky-top">
        <div class="container d-flex justify-content-between align-items-center py-3">
            <div class="d-flex align-items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="text-purple-600" width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
                @if (userRole != null && userRole != "Customer")
                {
                    <span class="fs-4 fw-bold gradient-text text-decoration-none text-muted" style="pointer-events: none; opacity: 0.6;">
                        Gender Healthcare
                    </span>
                }
                else
                {
                    <a href="/" class="fs-4 fw-bold gradient-text text-decoration-none">Gender Healthcare</a>
                }
            </div>

            <div class="d-none d-md-flex gap-4 nav-menu">
                @if (userRole == "Admin")
                {
                    <!-- Admin/Manager/Staff Menu -->
                    //Dashboard && Report (Phân tích)
                    <div class="dropdown nav-dropdown">
                        <a href="#" class="nav-link-custom dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-bar-chart-fill me-1"></i> Phân tích
                            <i class="bi bi-chevron-down ms-1 dropdown-arrow"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-custom">
                            <li>
                                <a href="/Admin/Dashboard" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-bar-chart-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Thống kê</div>
                                    </div>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a href="/Admin/Report" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-file-earmark-text-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Báo Cáo</div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>

                    //User && Staff & Consultant (Người dùng)
                    <div class="dropdown nav-dropdown">
                        <a href="#" class="nav-link-custom dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-people-fill me-1"></i> Người dùng
                            <i class="bi bi-chevron-down ms-1 dropdown-arrow"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-custom">
                            <li>
                                <a href="UserManager" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-person-heart me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Người dùng</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-person-heart me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Khách hàng</div>
                                    </div>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a href="#" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-person-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Nhân viên</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-person-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Tư vấn viên</div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>

                    //Cơ sở
                    <a href="/Clinics/Index" class="nav-link-custom">
                        <i class="bi bi-house-heart-fill me-1"></i> Cơ sở
                    </a>

                    //Consultation - Question && Test - Service (Dịch vụ)
                    <div class="dropdown nav-dropdown">
                        <a href="#" class="nav-link-custom dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-clipboard2-pulse-fill me-1"></i> Dịch vụ
                            <i class="bi bi-chevron-down ms-1 dropdown-arrow"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-custom">
                            <li>
                                <a href="/Questions/Index" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-question-square-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Hỏi đáp</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="/Consultations/Index" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-calendar-week-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Lịch tư vấn</div>
                                    </div>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a href="#" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-clipboard2-pulse-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Gói dịch vụ</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-eyedropper me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Lịch Xét nghiệm</div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>

                    //Blog && Feedback(chia sẻ)
                    <div class="dropdown nav-dropdown">
                        <a href="#" class="nav-link-custom dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-megaphone-fill me-1"></i> Chia sẻ
                            <i class="bi bi-chevron-down ms-1 dropdown-arrow"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-custom">
                            <li>
                                <a href="/Questions/Index" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-journal-text me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Blog</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="/Feedbacks/Index" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-star-fill me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Đánh giá</div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                }

                else if (userRole == "Consultant")
                {
                    <!-- Consultant Menu -->
                    <a href="/Consultations/Index" class="nav-link-custom">
                        <i class="bi bi-calendar-week-fill me-1"></i> Lịch tư vấn
                    </a>
                    <a href="#" class="nav-link-custom">
                        <i class="bi bi-question-square-fill me-1"></i> Hỏi đáp
                    </a>
                    <a href="/Feedbacks/Index" class="nav-link-custom">
                        <i class="bi bi-star-fill me-1"></i> Đánh giá
                    </a>
                }
                else if(userRole == "Staff")
                {
                    <!-- Staff Menu -->
                    <a href="#" class="nav-link-custom">
                        <i class="bi bi-calendar-week-fill me-1"></i> Lịch xét nghiệm
                    </a>
                    <a href="#" class="nav-link-custom">
                        <i class="bi bi-question-square-fill me-1"></i> Dịch vụ
                    </a>
                }
                else
                {
                    <!-- User Menu (Customer, Guest, hoặc null) -->
                    <a href="/Cus_Clinics" class="nav-link-custom">
                        <i class="bi bi-hospital-fill me-1"></i> Phòng khám
                    </a>
                    <a href="/Services" class="nav-link-custom">
                        <i class="bi bi-clipboard2-pulse-fill me-1"></i> Gói dịch vụ
                    </a>
                    <div class="dropdown nav-dropdown">
                        <a href="#" class="nav-link-custom dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-chat-dots-fill me-1"></i> Tư vấn chuyên gia
                            <i class="bi bi-chevron-down ms-1 dropdown-arrow"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-custom">
                            <li>
                                <a href="/ExpertConsultation/Question" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-chat-square-text me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Đặt câu hỏi cho tư vấn viên</div>
                                        <small class="text-muted">Tư vấn cơ bản, phản hồi nhanh</small>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="/ExpertConsultation/Booking/BookingConsultant" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-calendar-check me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Đặt lịch tư vấn</div>
                                        <small class="text-muted">Tư vấn chuyên sâu với bác sĩ</small>
                                    </div>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a href="/ExpertConsultation/MyQuestion" class="dropdown-item dropdown-item-custom">
                                    <i class="bi bi-question-circle me-3"></i>
                                    <div>
                                        <div class="fw-semibold">Lịch sử câu hỏi của tôi</div>
                                        <small class="text-muted">Xem lại các câu hỏi đã gửi</small>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <a href="/AboutUs" class="nav-link-custom">
                        <i class="bi bi-info-circle-fill me-1"></i> Về chúng tôi
                    </a>
                }
            </div>


            <!-- Login/User Info -->
            @if (currentUser != null)
            {
                var profileLink = currentUser.Role == "Consultant" ? "/Consultant/Profile" : "/Profile";

                <a href="@profileLink" class="btn btn-primary btn-sm" style="background: linear-gradient(to right, #9333ea, #ec4899); border: none;">
                    <i class="bi bi-person-circle me-1"></i> @currentUser.Username
                </a>
            }

            else
            {
                <a href="/Login" class="btn btn-primary btn-sm" style="background: linear-gradient(to right, #9333ea, #ec4899); border: none;">
                    <i class="bi bi-person-circle me-1"></i> Đăng nhập
                </a>
            }
        </div>
    </nav>

    <!-- Main -->
    <main class="flex-grow-1">
        <div class="container py-5">
            @RenderBody()
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer mt-auto">
        <div class="container text-center d-flex flex-column flex-md-row justify-content-between align-items-center">
            <div class="mb-2 mb-md-0 d-flex align-items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="text-purple-400" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
                <span class="fw-semibold small">Gender Healthcare</span>
            </div>
            <div class="text-muted small d-flex flex-column flex-md-row align-items-center gap-2">
                <span>© 2025 Gender Healthcare System. All rights reserved.</span>
                <a href="/Privacy" class="text-decoration-none text-purple-600 fw-semibold">
                    Privacy Policy
                </a>
            </div>
        </div>
    </footer>

    @RenderSection("Scripts", required: false)
</body>
</html>

<style>
    .nav-menu .nav-link-custom {
        display: inline-flex;
        align-items: center;
        padding: 8px 14px;
        border-radius: 10px;
        font-weight: 500;
        color: #9333ea;
        background-color: transparent;
        text-decoration: none;
        transition: all 0.3s ease-in-out;
    }

        .nav-menu .nav-link-custom i {
            color: #9333ea;
            transition: color 0.3s ease-in-out;
        }

        .nav-menu .nav-link-custom:hover {
            background: linear-gradient(to right, #a855f7, #ec4899);
            color: white;
            box-shadow: 0 0 12px rgba(236, 72, 153, 0.4);
        }

            .nav-menu .nav-link-custom:hover i {
                color: white;
            }
    .nav-dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-menu-custom {
        display: none;
        position: absolute;
        top: calc(100% + 5px);
        left: 0;
        background: white;
        min-width: 300px;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(147, 51, 234, 0.1);
        z-index: 9999;
        overflow: hidden;
        /* Add padding to prevent hover loss */
        padding-top: 5px;
        margin-top: -5px;
    }

    /* Show dropdown on hover - with better targeting */
    .nav-dropdown:hover .dropdown-menu-custom,
    .dropdown-menu-custom:hover {
        display: block;
        animation: fadeInDown 0.3s ease-out;
    }

    /* Keep dropdown visible when hovering over it */
    .nav-dropdown:hover .dropdown-menu-custom {
        display: block;
    }

    @@keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .dropdown-item-custom {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        color: #374151;
        text-decoration: none;
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(147, 51, 234, 0.1);
        cursor: pointer;
    }

    .dropdown-item-custom:last-child {
        border-bottom: none;
    }

    .dropdown-item-custom:hover {
        background: linear-gradient(to right, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
        color: #9333ea;
        text-decoration: none;
    }

    .dropdown-item-custom i {
        color: #9333ea;
        font-size: 1.2rem;
        min-width: 24px;
    }

    .dropdown-arrow {
        transition: transform 0.3s ease;
        font-size: 0.8rem;
    }

    .nav-dropdown:hover .dropdown-arrow {
        transform: rotate(180deg);
    }

    /* Alternative: Click-based dropdown using Bootstrap */
    .dropdown-toggle::after {
        display: none;
    }
</style>